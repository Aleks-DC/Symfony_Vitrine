{# templates/components/Pricing.html.twig #}
<section id="{{ sectionId }}">
    <form class="group/tiers isolate overflow-hidden bg-gray-900">
        <div class="flow-root border-b border-b-white/5 bg-gray-800/25 pt-24 pb-16 sm:pt-32 lg:pb-0">
            <div class="mx-auto max-w-7xl px-6 lg:px-8">
                <div class="relative z-10">
                    <h2 class="mx-auto max-w-4xl text-center text-5xl font-semibold tracking-tight text-balance text-white sm:text-6xl">
                        {{ headline }}
                    </h2>

                    {% if subheadline %}
                        <p class="mx-auto mt-6 max-w-2xl text-center text-lg font-medium text-pretty text-gray-400 sm:text-xl/8">
                            {{ subheadline }}
                        </p>
                    {% endif %}

                    <div class="mt-16 flex justify-center">
                        <fieldset aria-label="Payment frequency">
                            <div class="grid grid-cols-2 gap-x-1 rounded-full bg-white/5 p-1 text-center text-xs/5 font-semibold text-white">
                                <label class="group relative rounded-full px-2.5 py-1 has-checked:bg-indigo-500">
                                    <input type="radio" name="frequency" value="monthly" checked class="absolute inset-0 appearance-none rounded-full" />
                                    <span class="text-white">{{ labelMonthly }}</span>
                                </label>
                                <label class="group relative rounded-full px-2.5 py-1 has-checked:bg-indigo-500">
                                    <input type="radio" name="frequency" value="annually" class="absolute inset-0 appearance-none rounded-full" />
                                    <span class="text-white">{{ labelAnnually }}</span>
                                </label>
                            </div>
                        </fieldset>
                    </div>
                </div>

                {% if cols|length and tiersByKey|length %}
                    <div class="relative mx-auto mt-10 grid max-w-md grid-cols-1 gap-y-8 lg:mx-0 lg:-mb-14 lg:max-w-none lg:grid-cols-3">
                        <svg viewBox="0 0 1208 1024" aria-hidden="true" class="absolute -bottom-48 left-1/2 h-256 -translate-x-1/2 translate-y-1/2 mask-[radial-gradient(closest-side,white,transparent)] lg:-top-48 lg:bottom-auto lg:translate-y-0">
                            <ellipse cx="604" cy="512" rx="604" ry="512" fill="url(#d25c25d4-6d43-4bf9-b9ac-1842a30a4867)" />
                            <defs>
                                <radialGradient id="d25c25d4-6d43-4bf9-b9ac-1842a30a4867">
                                    <stop stop-color="#7775D6" />
                                    <stop offset="1" stop-color="#E935C1" />
                                </radialGradient>
                            </defs>
                        </svg>

                        <div aria-hidden="true" class="hidden lg:absolute lg:inset-x-px lg:top-4 lg:bottom-0 lg:block lg:rounded-t-2xl lg:bg-gray-800/80 lg:ring-1 lg:ring-white/10"></div>

                        {% for key in cols %}
                            {% set t = tiersByKey[key] ?? {} %}
                            {% set featured = t.featured ?? false %}

                            <div {{ featured ? 'data-featured="true"' : '' }}
                                class="group/tier relative {{ featured ? 'z-10 rounded-2xl bg-gray-800 outline-1 -outline-offset-1 outline-white/10' : 'rounded-2xl bg-gray-800/80 outline-1 -outline-offset-1 outline-white/10 lg:bg-transparent lg:pb-14 lg:outline-0' }}">
                                <div class="p-8 lg:pt-12 xl:p-10 xl:pt-14">
                                    <h3 id="tier-{{ key }}" class="text-sm/6 font-semibold text-white">{{ t.name|default(key|capitalize) }}</h3>

                                    <div class="flex flex-col gap-6 sm:flex-row sm:items-end sm:justify-between lg:flex-col lg:items-stretch">
                                        <div class="mt-2 flex items-center gap-x-4">
                                            <p class="text-4xl font-semibold tracking-tight text-white group-not-has-[[name=frequency][value=monthly]:checked]/tiers:hidden">
                                                {{ currencySymbol }}{{ t.price.monthly|default(0) }}
                                            </p>
                                            <p class="text-4xl font-semibold tracking-tight text-white group-not-has-[[name=frequency][value=annually]:checked]/tiers:hidden">
                                                {{ currencySymbol }}{{ t.price.annually|default(0) }}
                                            </p>
                                            <div class="text-sm">
                                                <p class="text-white">{{ currency }}</p>
                                                <p class="text-gray-400 group-not-has-[[name=frequency][value=monthly]:checked]/tiers:hidden">{{ billedMonthly }}</p>
                                                <p class="text-gray-400 group-not-has-[[name=frequency][value=annually]:checked]/tiers:hidden">{{ billedAnnually }}</p>
                                            </div>
                                        </div>

                                        {% set cta = t.cta ?? {} %}
                                        <button type="submit" name="tier" value="tier-{{ key }}" aria-describedby="tier-{{ key }}"
                                                class="w-full rounded-md bg-white/10 px-3 py-2 text-center text-sm/6 font-semibold text-white not-group-data-featured:inset-ring not-group-data-featured:inset-ring-white/5 group-data-featured/tier:bg-indigo-500 hover:bg-white/20 group-data-featured/tier:hover:bg-indigo-400 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/75 group-data-featured/tier:focus-visible:outline-indigo-500">
                                            {{ cta.label|default('Buy this plan') }}
                                        </button>
                                    </div>

                                    {% if t.perks is iterable and t.perks|length %}
                                        <div class="mt-8 flow-root sm:mt-10">
                                            <ul role="list" class="-my-2 divide-y divide-white/5 border-t border-white/5 text-sm/6 text-white group-data-featured/tier:divide-white/10 group-data-featured/tier:border-white/10 lg:border-t-0">
                                                {% for perk in t.perks %}
                                                    <li class="flex gap-x-3 py-2">
                                                        <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="h-6 w-5 flex-none text-gray-500 group-data-featured/tier:text-indigo-400">
                                                            <path d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z" clip-rule="evenodd" fill-rule="evenodd" />
                                                        </svg>
                                                        {{ perk }}
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>

        {% if cols|length and groups|length %}
            <div class="relative bg-gray-900 lg:pt-14">
                <div class="mx-auto max-w-7xl px-6 py-24 sm:py-32 lg:px-8">

                    {# Mobile comparison #}
                    <section aria-labelledby="mobile-comparison-heading" class="lg:hidden">
                        <h2 id="mobile-comparison-heading" class="sr-only">Feature comparison</h2>
                        <div class="mx-auto max-w-2xl space-y-16">
                            {% for key in cols %}
                                {% set t = tiersByKey[key] ?? {} %}
                                {% set featured = t.featured ?? false %}

                                <div class="border-t border-white/10">
                                    <div class="-mt-px w-72 border-t-2 {{ featured ? 'border-indigo-500' : 'border-transparent' }} pt-10 md:w-80">
                                        <h3 class="text-sm/6 font-semibold {{ featured ? 'text-indigo-400' : 'text-white' }}">{{ t.name|default(key|capitalize) }}</h3>
                                        {% if t.description is defined and t.description %}
                                            <p class="mt-1 text-sm/6 text-gray-400">{{ t.description }}</p>
                                        {% endif %}
                                    </div>

                                    <div class="mt-10 space-y-10">
                                        {% for g in groups %}
                                            <div>
                                                <h4 class="text-sm/6 font-semibold text-white">{{ g.title }}</h4>
                                                <div class="relative mt-6">
                                                    <div aria-hidden="true" class="absolute inset-y-0 right-0 hidden w-1/2 rounded-lg bg-gray-800/50 sm:block"></div>
                                                    <div class="relative rounded-lg bg-gray-800/50 {{ featured ? 'ring-2 ring-indigo-500' : 'ring-1 ring-white/10' }} sm:rounded-none sm:bg-transparent sm:ring-0">
                                                        <dl class="divide-y divide-white/10 text-sm/6">
                                                            {% for r in g.rows %}
                                                                {% set val = r.values[key] ?? null %}
                                                                {% set yes = (val is same as(true)) or (val == 'yes') or (val == 'Yes') or (val == 1) %}
                                                                {% set no  = (val is same as(false)) or (val == 'no')  or (val == 'No')  or (val == 0) %}
                                                                <div class="flex items-center justify-between px-4 py-3 sm:grid sm:grid-cols-2 sm:px-0">
                                                                    <dt class="pr-4 text-gray-400">{{ r.label }}</dt>
                                                                    <dd class="flex items-center justify-end sm:justify-center sm:px-4">
                                                                        {% if yes %}
                                                                            <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="mx-auto size-5 text-indigo-400">
                                                                                <path d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z" clip-rule="evenodd" fill-rule="evenodd" />
                                                                            </svg>
                                                                            <span class="sr-only">Yes</span>
                                                                        {% elseif no %}
                                                                            <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="mx-auto size-5 text-gray-600">
                                                                                <path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"/>
                                                                            </svg>
                                                                            <span class="sr-only">No</span>
                                                                        {% else %}
                                                                            <span class="{{ featured and (val == 'Unlimited') ? 'font-semibold text-indigo-400' : 'text-white' }}">{{ val }}</span>
                                                                        {% endif %}
                                                                    </dd>
                                                                </div>
                                                            {% endfor %}
                                                        </dl>
                                                    </div>
                                                    <div aria-hidden="true" class="pointer-events-none absolute inset-y-0 right-0 hidden w-1/2 rounded-lg {{ featured ? 'ring-2 ring-indigo-500' : 'ring-1 ring-white/10' }} sm:block"></div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </section>

                    {# Desktop comparison (3 colonnes fixées à l'ordre YAML) #}
                    {% if cols|length >= 3 %}
                        {% set a = cols[0] %}{% set b = cols[1] %}{% set c = cols[2] %}
                        {% set tA = tiersByKey[a] ?? {} %}{% set tB = tiersByKey[b] ?? {} %}{% set tC = tiersByKey[c] ?? {} %}

                        <section aria-labelledby="comparison-heading" class="hidden lg:block">
                            <h2 id="comparison-heading" class="sr-only">Feature comparison</h2>

                            <div class="grid grid-cols-4 gap-x-8 border-t border-white/10 before:block">
                                <div aria-hidden="true" class="-mt-px">
                                    <div class="border-t-2 border-transparent pt-10">
                                        <p class="text-sm/6 font-semibold text-white">{{ tA.name|default(a|capitalize) }}</p>
                                        {% if tA.description is defined %}<p class="mt-1 text-sm/6 text-gray-400">{{ tA.description }}</p>{% endif %}
                                    </div>
                                </div>
                                <div aria-hidden="true" class="-mt-px">
                                    <div class="border-t-2 border-indigo-500 pt-10">
                                        <p class="text-sm/6 font-semibold text-indigo-400">{{ tB.name|default(b|capitalize) }}</p>
                                        {% if tB.description is defined %}<p class="mt-1 text-sm/6 text-gray-400">{{ tB.description }}</p>{% endif %}
                                    </div>
                                </div>
                                <div aria-hidden="true" class="-mt-px">
                                    <div class="border-t-2 border-transparent pt-10">
                                        <p class="text-sm/6 font-semibold text-white">{{ tC.name|default(c|capitalize) }}</p>
                                        {% if tC.description is defined %}<p class="mt-1 text-sm/6 text-gray-400">{{ tC.description }}</p>{% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="-mt-6 space-y-16">
                                {% for g in groups %}
                                    <div>
                                        <h3 class="text-sm/6 font-semibold text-white">{{ g.title }}</h3>
                                        <div class="relative -mx-8 mt-10">
                                            <div aria-hidden="true" class="absolute inset-x-8 inset-y-0 grid grid-cols-4 gap-x-8 before:block">
                                                <div class="size-full rounded-lg bg-gray-800/50"></div>
                                                <div class="size-full rounded-lg bg-gray-800/50"></div>
                                                <div class="size-full rounded-lg bg-gray-800/50"></div>
                                            </div>

                                            <table class="relative w-full border-separate border-spacing-x-8">
                                                <thead>
                                                <tr class="text-left">
                                                    <th scope="col"><span class="sr-only">Feature</span></th>
                                                    <th scope="col"><span class="sr-only">{{ tA.name|default('Tier A') }} tier</span></th>
                                                    <th scope="col"><span class="sr-only">{{ tB.name|default('Tier B') }} tier</span></th>
                                                    <th scope="col"><span class="sr-only">{{ tC.name|default('Tier C') }} tier</span></th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% for r in g.rows %}
                                                    <tr>
                                                        <th scope="row" class="w-1/4 py-3 pr-4 text-left text-sm/6 font-normal text-white">
                                                            {{ r.label }}
                                                            <div class="absolute inset-x-8 mt-3 h-px bg-white/10"></div>
                                                        </th>

                                                        {% for key in [a, b, c] %}
                                                            {% set val = r.values[key] ?? null %}
                                                            {% set yes = (val is same as(true)) or (val == 'yes') or (val == 'Yes') or (val == 1) %}
                                                            {% set no  = (val is same as(false)) or (val == 'no')  or (val == 'No')  or (val == 0) %}
                                                            <td class="relative w-1/4 px-4 py-0 text-center">
                                  <span class="relative size-full py-3">
                                    {% if yes %}
                                        <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="mx-auto size-5 text-indigo-400">
                                        <path d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z" clip-rule="evenodd" fill-rule="evenodd" />
                                      </svg>
                                        <span class="sr-only">Yes</span>
                                    {% elseif no %}
                                        <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="mx-auto size-5 text-gray-600">
                                        <path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"/>
                                      </svg>
                                        <span class="sr-only">No</span>
                                    {% else %}
                                        <span class="text-sm/6 {{ key == b and (val == 'Unlimited') ? 'font-semibold text-indigo-400' : 'text-white' }}">{{ val }}</span>
                                    {% endif %}
                                  </span>
                                                            </td>
                                                        {% endfor %}
                                                    </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>

                                            <div aria-hidden="true" class="pointer-events-none absolute inset-x-8 inset-y-0 grid grid-cols-4 gap-x-8 before:block">
                                                <div class="rounded-lg ring-1 ring-white/10"></div>
                                                <div class="rounded-lg ring-2 ring-indigo-500"></div>
                                                <div class="rounded-lg ring-1 ring-white/10"></div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </section>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </form>
</section>
