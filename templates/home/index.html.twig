{% extends 'base.html.twig' %}

{% block title %}Test – Développeur Backend Freelance{% endblock %}
{% block meta_description %}Création de sites vitrines et web-apps performantes en Pays de la Loire et partout en France.{% endblock %}

{% block body %}

    {# 1) Macro pour les ancres #}
    {% macro anchor(id, type) %}
        {% if id %}
            {% set cls = (type == 'hero') ? 'scroll-anchor' : 'relative block h-0 invisible -top-[var(--header-h)]' %}
            <a id="{{ id }}" class="{{ cls }}" aria-hidden="true"></a>
        {% endif %}
    {% endmacro %}
    {% import _self as ui %}

    {# 2) Config ancres + wrappers #}
    {% set anchorIds = {
        'hero': 'accueil',
        'services': 'services',
        'process': 'methode',
        'pricing': 'tarifs',
        'testimonials': 'avis',
        'contact': 'contact'
    } %}
    {% set wrapInSection = {
        'services': true,
        'process': true
    } %}

    {# 3) Boucle principale (version compatible) #}
    {% for c in components %}
        {% if c.enabled %}

            {{ ui.anchor(anchorIds[c.type]|default(null), c.type) }}

            {% if c.type == 'header' %}
                <twig:Header
                    :brand="c.data.brand ?? {}"
                    :menu="c.data.menu ?? []"
                    :auth="c.data.auth ?? {}"
                    :mobile="c.data.mobile ?? {}"
                />

            {% elseif c.type == 'footer' %}
                <twig:Footer />

            {% elseif c.type == 'stats' %}
                <twig:Stats :items="c.data" />

            {% elseif c.type == 'pricing' %}
                <twig:Pricing :tiers="c.data" />

            {% elseif c.type == 'testimonials' %}
                <twig:Testimonials :quotes="c.data" layout="auto" />

            {% elseif c.type == 'contact' %}
                <twig:ContactForm
                    :data="c.data"
                    action="{{ path('contact_submit') }}"
                    :values="contactValues"
                    :errors="contactErrors"
                    :contactSuccess="contactSuccess"
                />

            {% else %}
                {# fallback components/ puis partials/_ #}
                {% set candidates = [
                    'components/' ~ c.type ~ '.html.twig',
                    'partials/_' ~ c.type ~ '.html.twig'
                ] %}

                {% if wrapInSection[c.type]|default(false) %}<section>{% endif %}
                {{ include(
                    candidates,
                    { (c.type): c.data, data: c.data, type: c.type },
                    false,  true
                ) }}
                {% if wrapInSection[c.type]|default(false) %}</section>{% endif %}
            {% endif %} {# <-- ferme le grand if/elseif/else des types #}

            {# 4) Debug optionnel #}
            {% if app.debug %}
                {% set rendered = include(
                    candidates|default([]),
                    { (c.type): c.data, data: c.data, type: c.type },
                    false, true
                ) %}
                {% set isTwigComponent = c.type in ['header','footer','stats','pricing','testimonials','contact'] %}
                {% if not isTwigComponent and rendered is empty %}
                    <div class="p-4 my-4 text-sm text-yellow-900 bg-yellow-50 border border-yellow-200 rounded">
                        ⚠️ Aucun template trouvé pour <code>{{ c.type }}</code>
                        (cherché dans <code>components/</code> et <code>partials/</code>).
                    </div>
                {% endif %}
            {% endif %}

        {% endif %}
    {% endfor %}

{% endblock %}
